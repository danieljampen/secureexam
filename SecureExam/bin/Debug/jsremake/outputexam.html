<!DOCTYPE html>
<html>
<head lang="en">
	<meta charset="UTF-8">
	<title></title>
    <style>
        body {
            margin:0px;
            font-size: 16px;
            font-family: "RobotoDraft", Helvetica, Arial, sans-serif;
            font-weight: 300;
            line-height: 24px;
            background-color: #f4f4f4;
        }

        .paper {
            box-shadow: 0px 0px 10px 1px rgba(0,0,0,0.75);
        }

        .header {
            width: 100%;
            background-color: #3e50b4;
            height: 105px;
            position: fixed;
            top: 0;
            color: #fff;
            padding-left: 3%;
            z-index: 20;
        }

        .headerStudentInfo {
            font-size: 15px;
            margin-top: 1px;
            font-weight: 300;
        }

        .headerNotes {
            position: absolute;
            top: 5px;
            right: 8%;
            text-align: right;
        }

        .headerTitle {
            font-size: 28px;
            margin-top: 55px;
            font-weight: bold;
        }

        .examNotes {
            background-color: #334293;
            top: 85px;
            position: relative;
            z-index: -2;
            min-height: 230px;
            padding-left: 3%;
            padding-right: 3%;
            padding-bottom: 25px;
            padding-top: 10px;
            width: 94%;
            color: #fff;
        }

        .examContainer {
            position: relative;
            width: 94%;
            margin: 0px auto;
            z-index: 10;
            top: -20px;
            margin-bottom: 3%;
            background-color: white;
        }

        .center {
            margin: 0px auto;
            text-align: center;
        }

        .longShizzle {
            display: inline-block;
            width: 100%;
            word-wrap: break-word;
        }
        .hidden {
            display: none;
        }
        .headerHighlight {
            color: #ff0;
            font-weight: 600;
        }

        #finishButton {
            position: fixed;
            right: 5%;
            top: 68px;
        }
        .question {
            width: 100%;
        }
        .questionText {
            width: 100%;
            color: black;
            font-weight: 600;
            min-height: 80px;
            padding: 43px 0px 0px 32px;
        }
        .answer {
            width: 100%;
            padding: 0px 0px 10px 32px;
        }
        .textBox {
            width: 93%;
        }
        .zhaw {
            font-weight: 600;
            font-size: 18px;
            padding-right: 135px;
        }

        #autoSaveInfo {
            position: absolute;
            top: 35px;
            font-size: 13px;
            right: 8%;
        }
    </style>
	// libs
	<script>
        /*
        CryptoJS v3.1.2
        code.google.com/p/crypto-js AES
        (c) 2009-2013 by Jeff Mott. All rights reserved.
        code.google.com/p/crypto-js/wiki/License
        */
        var CryptoJS=CryptoJS||function(u,p){var d={},l=d.lib={},s=function(){},t=l.Base={extend:function(a){s.prototype=this;var c=new s;a&&c.mixIn(a);c.hasOwnProperty("init")||(c.init=function(){c.$super.init.apply(this,arguments)});c.init.prototype=c;c.$super=this;return c},create:function(){var a=this.extend();a.init.apply(a,arguments);return a},init:function(){},mixIn:function(a){for(var c in a)a.hasOwnProperty(c)&&(this[c]=a[c]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},clone:function(){return this.init.prototype.extend(this)}},
        r=l.WordArray=t.extend({init:function(a,c){a=this.words=a||[];this.sigBytes=c!=p?c:4*a.length},toString:function(a){return(a||v).stringify(this)},concat:function(a){var c=this.words,e=a.words,j=this.sigBytes;a=a.sigBytes;this.clamp();if(j%4)for(var k=0;k<a;k++)c[j+k>>>2]|=(e[k>>>2]>>>24-8*(k%4)&255)<<24-8*((j+k)%4);else if(65535<e.length)for(k=0;k<a;k+=4)c[j+k>>>2]=e[k>>>2];else c.push.apply(c,e);this.sigBytes+=a;return this},clamp:function(){var a=this.words,c=this.sigBytes;a[c>>>2]&=4294967295<<
        32-8*(c%4);a.length=u.ceil(c/4)},clone:function(){var a=t.clone.call(this);a.words=this.words.slice(0);return a},random:function(a){for(var c=[],e=0;e<a;e+=4)c.push(4294967296*u.random()|0);return new r.init(c,a)}}),w=d.enc={},v=w.Hex={stringify:function(a){var c=a.words;a=a.sigBytes;for(var e=[],j=0;j<a;j++){var k=c[j>>>2]>>>24-8*(j%4)&255;e.push((k>>>4).toString(16));e.push((k&15).toString(16))}return e.join("")},parse:function(a){for(var c=a.length,e=[],j=0;j<c;j+=2)e[j>>>3]|=parseInt(a.substr(j,
        2),16)<<24-4*(j%8);return new r.init(e,c/2)}},b=w.Latin1={stringify:function(a){var c=a.words;a=a.sigBytes;for(var e=[],j=0;j<a;j++)e.push(String.fromCharCode(c[j>>>2]>>>24-8*(j%4)&255));return e.join("")},parse:function(a){for(var c=a.length,e=[],j=0;j<c;j++)e[j>>>2]|=(a.charCodeAt(j)&255)<<24-8*(j%4);return new r.init(e,c)}},x=w.Utf8={stringify:function(a){try{return decodeURIComponent(escape(b.stringify(a)))}catch(c){throw Error("Malformed UTF-8 data");}},parse:function(a){return b.parse(unescape(encodeURIComponent(a)))}},
        q=l.BufferedBlockAlgorithm=t.extend({reset:function(){this._data=new r.init;this._nDataBytes=0},_append:function(a){"string"==typeof a&&(a=x.parse(a));this._data.concat(a);this._nDataBytes+=a.sigBytes},_process:function(a){var c=this._data,e=c.words,j=c.sigBytes,k=this.blockSize,b=j/(4*k),b=a?u.ceil(b):u.max((b|0)-this._minBufferSize,0);a=b*k;j=u.min(4*a,j);if(a){for(var q=0;q<a;q+=k)this._doProcessBlock(e,q);q=e.splice(0,a);c.sigBytes-=j}return new r.init(q,j)},clone:function(){var a=t.clone.call(this);
        a._data=this._data.clone();return a},_minBufferSize:0});l.Hasher=q.extend({cfg:t.extend(),init:function(a){this.cfg=this.cfg.extend(a);this.reset()},reset:function(){q.reset.call(this);this._doReset()},update:function(a){this._append(a);this._process();return this},finalize:function(a){a&&this._append(a);return this._doFinalize()},blockSize:16,_createHelper:function(a){return function(b,e){return(new a.init(e)).finalize(b)}},_createHmacHelper:function(a){return function(b,e){return(new n.HMAC.init(a,
        e)).finalize(b)}}});var n=d.algo={};return d}(Math);
        (function(){var u=CryptoJS,p=u.lib.WordArray;u.enc.Base64={stringify:function(d){var l=d.words,p=d.sigBytes,t=this._map;d.clamp();d=[];for(var r=0;r<p;r+=3)for(var w=(l[r>>>2]>>>24-8*(r%4)&255)<<16|(l[r+1>>>2]>>>24-8*((r+1)%4)&255)<<8|l[r+2>>>2]>>>24-8*((r+2)%4)&255,v=0;4>v&&r+0.75*v<p;v++)d.push(t.charAt(w>>>6*(3-v)&63));if(l=t.charAt(64))for(;d.length%4;)d.push(l);return d.join("")},parse:function(d){var l=d.length,s=this._map,t=s.charAt(64);t&&(t=d.indexOf(t),-1!=t&&(l=t));for(var t=[],r=0,w=0;w<
        l;w++)if(w%4){var v=s.indexOf(d.charAt(w-1))<<2*(w%4),b=s.indexOf(d.charAt(w))>>>6-2*(w%4);t[r>>>2]|=(v|b)<<24-8*(r%4);r++}return p.create(t,r)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}})();
        (function(u){function p(b,n,a,c,e,j,k){b=b+(n&a|~n&c)+e+k;return(b<<j|b>>>32-j)+n}function d(b,n,a,c,e,j,k){b=b+(n&c|a&~c)+e+k;return(b<<j|b>>>32-j)+n}function l(b,n,a,c,e,j,k){b=b+(n^a^c)+e+k;return(b<<j|b>>>32-j)+n}function s(b,n,a,c,e,j,k){b=b+(a^(n|~c))+e+k;return(b<<j|b>>>32-j)+n}for(var t=CryptoJS,r=t.lib,w=r.WordArray,v=r.Hasher,r=t.algo,b=[],x=0;64>x;x++)b[x]=4294967296*u.abs(u.sin(x+1))|0;r=r.MD5=v.extend({_doReset:function(){this._hash=new w.init([1732584193,4023233417,2562383102,271733878])},
        _doProcessBlock:function(q,n){for(var a=0;16>a;a++){var c=n+a,e=q[c];q[c]=(e<<8|e>>>24)&16711935|(e<<24|e>>>8)&4278255360}var a=this._hash.words,c=q[n+0],e=q[n+1],j=q[n+2],k=q[n+3],z=q[n+4],r=q[n+5],t=q[n+6],w=q[n+7],v=q[n+8],A=q[n+9],B=q[n+10],C=q[n+11],u=q[n+12],D=q[n+13],E=q[n+14],x=q[n+15],f=a[0],m=a[1],g=a[2],h=a[3],f=p(f,m,g,h,c,7,b[0]),h=p(h,f,m,g,e,12,b[1]),g=p(g,h,f,m,j,17,b[2]),m=p(m,g,h,f,k,22,b[3]),f=p(f,m,g,h,z,7,b[4]),h=p(h,f,m,g,r,12,b[5]),g=p(g,h,f,m,t,17,b[6]),m=p(m,g,h,f,w,22,b[7]),
        f=p(f,m,g,h,v,7,b[8]),h=p(h,f,m,g,A,12,b[9]),g=p(g,h,f,m,B,17,b[10]),m=p(m,g,h,f,C,22,b[11]),f=p(f,m,g,h,u,7,b[12]),h=p(h,f,m,g,D,12,b[13]),g=p(g,h,f,m,E,17,b[14]),m=p(m,g,h,f,x,22,b[15]),f=d(f,m,g,h,e,5,b[16]),h=d(h,f,m,g,t,9,b[17]),g=d(g,h,f,m,C,14,b[18]),m=d(m,g,h,f,c,20,b[19]),f=d(f,m,g,h,r,5,b[20]),h=d(h,f,m,g,B,9,b[21]),g=d(g,h,f,m,x,14,b[22]),m=d(m,g,h,f,z,20,b[23]),f=d(f,m,g,h,A,5,b[24]),h=d(h,f,m,g,E,9,b[25]),g=d(g,h,f,m,k,14,b[26]),m=d(m,g,h,f,v,20,b[27]),f=d(f,m,g,h,D,5,b[28]),h=d(h,f,
        m,g,j,9,b[29]),g=d(g,h,f,m,w,14,b[30]),m=d(m,g,h,f,u,20,b[31]),f=l(f,m,g,h,r,4,b[32]),h=l(h,f,m,g,v,11,b[33]),g=l(g,h,f,m,C,16,b[34]),m=l(m,g,h,f,E,23,b[35]),f=l(f,m,g,h,e,4,b[36]),h=l(h,f,m,g,z,11,b[37]),g=l(g,h,f,m,w,16,b[38]),m=l(m,g,h,f,B,23,b[39]),f=l(f,m,g,h,D,4,b[40]),h=l(h,f,m,g,c,11,b[41]),g=l(g,h,f,m,k,16,b[42]),m=l(m,g,h,f,t,23,b[43]),f=l(f,m,g,h,A,4,b[44]),h=l(h,f,m,g,u,11,b[45]),g=l(g,h,f,m,x,16,b[46]),m=l(m,g,h,f,j,23,b[47]),f=s(f,m,g,h,c,6,b[48]),h=s(h,f,m,g,w,10,b[49]),g=s(g,h,f,m,
        E,15,b[50]),m=s(m,g,h,f,r,21,b[51]),f=s(f,m,g,h,u,6,b[52]),h=s(h,f,m,g,k,10,b[53]),g=s(g,h,f,m,B,15,b[54]),m=s(m,g,h,f,e,21,b[55]),f=s(f,m,g,h,v,6,b[56]),h=s(h,f,m,g,x,10,b[57]),g=s(g,h,f,m,t,15,b[58]),m=s(m,g,h,f,D,21,b[59]),f=s(f,m,g,h,z,6,b[60]),h=s(h,f,m,g,C,10,b[61]),g=s(g,h,f,m,j,15,b[62]),m=s(m,g,h,f,A,21,b[63]);a[0]=a[0]+f|0;a[1]=a[1]+m|0;a[2]=a[2]+g|0;a[3]=a[3]+h|0},_doFinalize:function(){var b=this._data,n=b.words,a=8*this._nDataBytes,c=8*b.sigBytes;n[c>>>5]|=128<<24-c%32;var e=u.floor(a/
        4294967296);n[(c+64>>>9<<4)+15]=(e<<8|e>>>24)&16711935|(e<<24|e>>>8)&4278255360;n[(c+64>>>9<<4)+14]=(a<<8|a>>>24)&16711935|(a<<24|a>>>8)&4278255360;b.sigBytes=4*(n.length+1);this._process();b=this._hash;n=b.words;for(a=0;4>a;a++)c=n[a],n[a]=(c<<8|c>>>24)&16711935|(c<<24|c>>>8)&4278255360;return b},clone:function(){var b=v.clone.call(this);b._hash=this._hash.clone();return b}});t.MD5=v._createHelper(r);t.HmacMD5=v._createHmacHelper(r)})(Math);
        (function(){var u=CryptoJS,p=u.lib,d=p.Base,l=p.WordArray,p=u.algo,s=p.EvpKDF=d.extend({cfg:d.extend({keySize:4,hasher:p.MD5,iterations:1}),init:function(d){this.cfg=this.cfg.extend(d)},compute:function(d,r){for(var p=this.cfg,s=p.hasher.create(),b=l.create(),u=b.words,q=p.keySize,p=p.iterations;u.length<q;){n&&s.update(n);var n=s.update(d).finalize(r);s.reset();for(var a=1;a<p;a++)n=s.finalize(n),s.reset();b.concat(n)}b.sigBytes=4*q;return b}});u.EvpKDF=function(d,l,p){return s.create(p).compute(d,
        l)}})();
        CryptoJS.lib.Cipher||function(u){var p=CryptoJS,d=p.lib,l=d.Base,s=d.WordArray,t=d.BufferedBlockAlgorithm,r=p.enc.Base64,w=p.algo.EvpKDF,v=d.Cipher=t.extend({cfg:l.extend(),createEncryptor:function(e,a){return this.create(this._ENC_XFORM_MODE,e,a)},createDecryptor:function(e,a){return this.create(this._DEC_XFORM_MODE,e,a)},init:function(e,a,b){this.cfg=this.cfg.extend(b);this._xformMode=e;this._key=a;this.reset()},reset:function(){t.reset.call(this);this._doReset()},process:function(e){this._append(e);return this._process()},
        finalize:function(e){e&&this._append(e);return this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(e){return{encrypt:function(b,k,d){return("string"==typeof k?c:a).encrypt(e,b,k,d)},decrypt:function(b,k,d){return("string"==typeof k?c:a).decrypt(e,b,k,d)}}}});d.StreamCipher=v.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var b=p.mode={},x=function(e,a,b){var c=this._iv;c?this._iv=u:c=this._prevBlock;for(var d=0;d<b;d++)e[a+d]^=
        c[d]},q=(d.BlockCipherMode=l.extend({createEncryptor:function(e,a){return this.Encryptor.create(e,a)},createDecryptor:function(e,a){return this.Decryptor.create(e,a)},init:function(e,a){this._cipher=e;this._iv=a}})).extend();q.Encryptor=q.extend({processBlock:function(e,a){var b=this._cipher,c=b.blockSize;x.call(this,e,a,c);b.encryptBlock(e,a);this._prevBlock=e.slice(a,a+c)}});q.Decryptor=q.extend({processBlock:function(e,a){var b=this._cipher,c=b.blockSize,d=e.slice(a,a+c);b.decryptBlock(e,a);x.call(this,
        e,a,c);this._prevBlock=d}});b=b.CBC=q;q=(p.pad={}).Pkcs7={pad:function(a,b){for(var c=4*b,c=c-a.sigBytes%c,d=c<<24|c<<16|c<<8|c,l=[],n=0;n<c;n+=4)l.push(d);c=s.create(l,c);a.concat(c)},unpad:function(a){a.sigBytes-=a.words[a.sigBytes-1>>>2]&255}};d.BlockCipher=v.extend({cfg:v.cfg.extend({mode:b,padding:q}),reset:function(){v.reset.call(this);var a=this.cfg,b=a.iv,a=a.mode;if(this._xformMode==this._ENC_XFORM_MODE)var c=a.createEncryptor;else c=a.createDecryptor,this._minBufferSize=1;this._mode=c.call(a,
        this,b&&b.words)},_doProcessBlock:function(a,b){this._mode.processBlock(a,b)},_doFinalize:function(){var a=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){a.pad(this._data,this.blockSize);var b=this._process(!0)}else b=this._process(!0),a.unpad(b);return b},blockSize:4});var n=d.CipherParams=l.extend({init:function(a){this.mixIn(a)},toString:function(a){return(a||this.formatter).stringify(this)}}),b=(p.format={}).OpenSSL={stringify:function(a){var b=a.ciphertext;a=a.salt;return(a?s.create([1398893684,
        1701076831]).concat(a).concat(b):b).toString(r)},parse:function(a){a=r.parse(a);var b=a.words;if(1398893684==b[0]&&1701076831==b[1]){var c=s.create(b.slice(2,4));b.splice(0,4);a.sigBytes-=16}return n.create({ciphertext:a,salt:c})}},a=d.SerializableCipher=l.extend({cfg:l.extend({format:b}),encrypt:function(a,b,c,d){d=this.cfg.extend(d);var l=a.createEncryptor(c,d);b=l.finalize(b);l=l.cfg;return n.create({ciphertext:b,key:c,iv:l.iv,algorithm:a,mode:l.mode,padding:l.padding,blockSize:a.blockSize,formatter:d.format})},
        decrypt:function(a,b,c,d){d=this.cfg.extend(d);b=this._parse(b,d.format);return a.createDecryptor(c,d).finalize(b.ciphertext)},_parse:function(a,b){return"string"==typeof a?b.parse(a,this):a}}),p=(p.kdf={}).OpenSSL={execute:function(a,b,c,d){d||(d=s.random(8));a=w.create({keySize:b+c}).compute(a,d);c=s.create(a.words.slice(b),4*c);a.sigBytes=4*b;return n.create({key:a,iv:c,salt:d})}},c=d.PasswordBasedCipher=a.extend({cfg:a.cfg.extend({kdf:p}),encrypt:function(b,c,d,l){l=this.cfg.extend(l);d=l.kdf.execute(d,
        b.keySize,b.ivSize);l.iv=d.iv;b=a.encrypt.call(this,b,c,d.key,l);b.mixIn(d);return b},decrypt:function(b,c,d,l){l=this.cfg.extend(l);c=this._parse(c,l.format);d=l.kdf.execute(d,b.keySize,b.ivSize,c.salt);l.iv=d.iv;return a.decrypt.call(this,b,c,d.key,l)}})}();
        (function(){for(var u=CryptoJS,p=u.lib.BlockCipher,d=u.algo,l=[],s=[],t=[],r=[],w=[],v=[],b=[],x=[],q=[],n=[],a=[],c=0;256>c;c++)a[c]=128>c?c<<1:c<<1^283;for(var e=0,j=0,c=0;256>c;c++){var k=j^j<<1^j<<2^j<<3^j<<4,k=k>>>8^k&255^99;l[e]=k;s[k]=e;var z=a[e],F=a[z],G=a[F],y=257*a[k]^16843008*k;t[e]=y<<24|y>>>8;r[e]=y<<16|y>>>16;w[e]=y<<8|y>>>24;v[e]=y;y=16843009*G^65537*F^257*z^16843008*e;b[k]=y<<24|y>>>8;x[k]=y<<16|y>>>16;q[k]=y<<8|y>>>24;n[k]=y;e?(e=z^a[a[a[G^z]]],j^=a[a[j]]):e=j=1}var H=[0,1,2,4,8,
        16,32,64,128,27,54],d=d.AES=p.extend({_doReset:function(){for(var a=this._key,c=a.words,d=a.sigBytes/4,a=4*((this._nRounds=d+6)+1),e=this._keySchedule=[],j=0;j<a;j++)if(j<d)e[j]=c[j];else{var k=e[j-1];j%d?6<d&&4==j%d&&(k=l[k>>>24]<<24|l[k>>>16&255]<<16|l[k>>>8&255]<<8|l[k&255]):(k=k<<8|k>>>24,k=l[k>>>24]<<24|l[k>>>16&255]<<16|l[k>>>8&255]<<8|l[k&255],k^=H[j/d|0]<<24);e[j]=e[j-d]^k}c=this._invKeySchedule=[];for(d=0;d<a;d++)j=a-d,k=d%4?e[j]:e[j-4],c[d]=4>d||4>=j?k:b[l[k>>>24]]^x[l[k>>>16&255]]^q[l[k>>>
        8&255]]^n[l[k&255]]},encryptBlock:function(a,b){this._doCryptBlock(a,b,this._keySchedule,t,r,w,v,l)},decryptBlock:function(a,c){var d=a[c+1];a[c+1]=a[c+3];a[c+3]=d;this._doCryptBlock(a,c,this._invKeySchedule,b,x,q,n,s);d=a[c+1];a[c+1]=a[c+3];a[c+3]=d},_doCryptBlock:function(a,b,c,d,e,j,l,f){for(var m=this._nRounds,g=a[b]^c[0],h=a[b+1]^c[1],k=a[b+2]^c[2],n=a[b+3]^c[3],p=4,r=1;r<m;r++)var q=d[g>>>24]^e[h>>>16&255]^j[k>>>8&255]^l[n&255]^c[p++],s=d[h>>>24]^e[k>>>16&255]^j[n>>>8&255]^l[g&255]^c[p++],t=
        d[k>>>24]^e[n>>>16&255]^j[g>>>8&255]^l[h&255]^c[p++],n=d[n>>>24]^e[g>>>16&255]^j[h>>>8&255]^l[k&255]^c[p++],g=q,h=s,k=t;q=(f[g>>>24]<<24|f[h>>>16&255]<<16|f[k>>>8&255]<<8|f[n&255])^c[p++];s=(f[h>>>24]<<24|f[k>>>16&255]<<16|f[n>>>8&255]<<8|f[g&255])^c[p++];t=(f[k>>>24]<<24|f[n>>>16&255]<<16|f[g>>>8&255]<<8|f[h&255])^c[p++];n=(f[n>>>24]<<24|f[g>>>16&255]<<16|f[h>>>8&255]<<8|f[k&255])^c[p++];a[b]=q;a[b+1]=s;a[b+2]=t;a[b+3]=n},keySize:8});u.AES=p._createHelper(d)})();

        /*
        CryptoJS v3.1.2
        code.google.com/p/crypto-js SHA256
        (c) 2009-2013 by Jeff Mott. All rights reserved.
        code.google.com/p/crypto-js/wiki/License
        */
        var CryptoJS=CryptoJS||function(h,s){var f={},t=f.lib={},g=function(){},j=t.Base={extend:function(a){g.prototype=this;var c=new g;a&&c.mixIn(a);c.hasOwnProperty("init")||(c.init=function(){c.$super.init.apply(this,arguments)});c.init.prototype=c;c.$super=this;return c},create:function(){var a=this.extend();a.init.apply(a,arguments);return a},init:function(){},mixIn:function(a){for(var c in a)a.hasOwnProperty(c)&&(this[c]=a[c]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},clone:function(){return this.init.prototype.extend(this)}},
        q=t.WordArray=j.extend({init:function(a,c){a=this.words=a||[];this.sigBytes=c!=s?c:4*a.length},toString:function(a){return(a||u).stringify(this)},concat:function(a){var c=this.words,d=a.words,b=this.sigBytes;a=a.sigBytes;this.clamp();if(b%4)for(var e=0;e<a;e++)c[b+e>>>2]|=(d[e>>>2]>>>24-8*(e%4)&255)<<24-8*((b+e)%4);else if(65535<d.length)for(e=0;e<a;e+=4)c[b+e>>>2]=d[e>>>2];else c.push.apply(c,d);this.sigBytes+=a;return this},clamp:function(){var a=this.words,c=this.sigBytes;a[c>>>2]&=4294967295<<
        32-8*(c%4);a.length=h.ceil(c/4)},clone:function(){var a=j.clone.call(this);a.words=this.words.slice(0);return a},random:function(a){for(var c=[],d=0;d<a;d+=4)c.push(4294967296*h.random()|0);return new q.init(c,a)}}),v=f.enc={},u=v.Hex={stringify:function(a){var c=a.words;a=a.sigBytes;for(var d=[],b=0;b<a;b++){var e=c[b>>>2]>>>24-8*(b%4)&255;d.push((e>>>4).toString(16));d.push((e&15).toString(16))}return d.join("")},parse:function(a){for(var c=a.length,d=[],b=0;b<c;b+=2)d[b>>>3]|=parseInt(a.substr(b,
        2),16)<<24-4*(b%8);return new q.init(d,c/2)}},k=v.Latin1={stringify:function(a){var c=a.words;a=a.sigBytes;for(var d=[],b=0;b<a;b++)d.push(String.fromCharCode(c[b>>>2]>>>24-8*(b%4)&255));return d.join("")},parse:function(a){for(var c=a.length,d=[],b=0;b<c;b++)d[b>>>2]|=(a.charCodeAt(b)&255)<<24-8*(b%4);return new q.init(d,c)}},l=v.Utf8={stringify:function(a){try{return decodeURIComponent(escape(k.stringify(a)))}catch(c){throw Error("Malformed UTF-8 data");}},parse:function(a){return k.parse(unescape(encodeURIComponent(a)))}},
        x=t.BufferedBlockAlgorithm=j.extend({reset:function(){this._data=new q.init;this._nDataBytes=0},_append:function(a){"string"==typeof a&&(a=l.parse(a));this._data.concat(a);this._nDataBytes+=a.sigBytes},_process:function(a){var c=this._data,d=c.words,b=c.sigBytes,e=this.blockSize,f=b/(4*e),f=a?h.ceil(f):h.max((f|0)-this._minBufferSize,0);a=f*e;b=h.min(4*a,b);if(a){for(var m=0;m<a;m+=e)this._doProcessBlock(d,m);m=d.splice(0,a);c.sigBytes-=b}return new q.init(m,b)},clone:function(){var a=j.clone.call(this);
        a._data=this._data.clone();return a},_minBufferSize:0});t.Hasher=x.extend({cfg:j.extend(),init:function(a){this.cfg=this.cfg.extend(a);this.reset()},reset:function(){x.reset.call(this);this._doReset()},update:function(a){this._append(a);this._process();return this},finalize:function(a){a&&this._append(a);return this._doFinalize()},blockSize:16,_createHelper:function(a){return function(c,d){return(new a.init(d)).finalize(c)}},_createHmacHelper:function(a){return function(c,d){return(new w.HMAC.init(a,
        d)).finalize(c)}}});var w=f.algo={};return f}(Math);
        (function(h){for(var s=CryptoJS,f=s.lib,t=f.WordArray,g=f.Hasher,f=s.algo,j=[],q=[],v=function(a){return 4294967296*(a-(a|0))|0},u=2,k=0;64>k;){var l;a:{l=u;for(var x=h.sqrt(l),w=2;w<=x;w++)if(!(l%w)){l=!1;break a}l=!0}l&&(8>k&&(j[k]=v(h.pow(u,0.5))),q[k]=v(h.pow(u,1/3)),k++);u++}var a=[],f=f.SHA256=g.extend({_doReset:function(){this._hash=new t.init(j.slice(0))},_doProcessBlock:function(c,d){for(var b=this._hash.words,e=b[0],f=b[1],m=b[2],h=b[3],p=b[4],j=b[5],k=b[6],l=b[7],n=0;64>n;n++){if(16>n)a[n]=
        c[d+n]|0;else{var r=a[n-15],g=a[n-2];a[n]=((r<<25|r>>>7)^(r<<14|r>>>18)^r>>>3)+a[n-7]+((g<<15|g>>>17)^(g<<13|g>>>19)^g>>>10)+a[n-16]}r=l+((p<<26|p>>>6)^(p<<21|p>>>11)^(p<<7|p>>>25))+(p&j^~p&k)+q[n]+a[n];g=((e<<30|e>>>2)^(e<<19|e>>>13)^(e<<10|e>>>22))+(e&f^e&m^f&m);l=k;k=j;j=p;p=h+r|0;h=m;m=f;f=e;e=r+g|0}b[0]=b[0]+e|0;b[1]=b[1]+f|0;b[2]=b[2]+m|0;b[3]=b[3]+h|0;b[4]=b[4]+p|0;b[5]=b[5]+j|0;b[6]=b[6]+k|0;b[7]=b[7]+l|0},_doFinalize:function(){var a=this._data,d=a.words,b=8*this._nDataBytes,e=8*a.sigBytes;
        d[e>>>5]|=128<<24-e%32;d[(e+64>>>9<<4)+14]=h.floor(b/4294967296);d[(e+64>>>9<<4)+15]=b;a.sigBytes=4*d.length;this._process();return this._hash},clone:function(){var a=g.clone.call(this);a._hash=this._hash.clone();return a}});s.SHA256=g._createHelper(f);s.HmacSHA256=g._createHmacHelper(f)})(Math);

        /*! @source http://purl.eligrey.com/github/FileSaver.js/blob/master/FileSaver.js */
        var saveAs=saveAs||"undefined"!==typeof navigator&&navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator)||function(a){"use strict";if("undefined"===typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var k=a.document,n=k.createElementNS("http://www.w3.org/1999/xhtml","a"),w="download"in n,x=function(c){var e=k.createEvent("MouseEvents");e.initMouseEvent("click",!0,!1,a,0,0,0,0,0,!1,!1,!1,!1,0,null);c.dispatchEvent(e)},q=a.webkitRequestFileSystem,u=a.requestFileSystem||q||a.mozRequestFileSystem,
        y=function(c){(a.setImmediate||a.setTimeout)(function(){throw c;},0)},r=0,s=function(c){var e=function(){"string"===typeof c?(a.URL||a.webkitURL||a).revokeObjectURL(c):c.remove()};a.chrome?e():setTimeout(e,10)},t=function(c,a,d){a=[].concat(a);for(var b=a.length;b--;){var l=c["on"+a[b]];if("function"===typeof l)try{l.call(c,d||c)}catch(f){y(f)}}},m=function(c,e){var d=this,b=c.type,l=!1,f,p,k=function(){t(d,["writestart","progress","write","writeend"])},g=function(){if(l||!f)f=(a.URL||a.webkitURL||
        a).createObjectURL(c);p?p.location.href=f:void 0==a.open(f,"_blank")&&"undefined"!==typeof safari&&(a.location.href=f);d.readyState=d.DONE;k();s(f)},h=function(a){return function(){if(d.readyState!==d.DONE)return a.apply(this,arguments)}},m={create:!0,exclusive:!1},v;d.readyState=d.INIT;e||(e="download");if(w)f=(a.URL||a.webkitURL||a).createObjectURL(c),n.href=f,n.download=e,x(n),d.readyState=d.DONE,k(),s(f);else{a.chrome&&b&&"application/octet-stream"!==b&&(v=c.slice||c.webkitSlice,c=v.call(c,0,
        c.size,"application/octet-stream"),l=!0);q&&"download"!==e&&(e+=".download");if("application/octet-stream"===b||q)p=a;u?(r+=c.size,u(a.TEMPORARY,r,h(function(a){a.root.getDirectory("saved",m,h(function(a){var b=function(){a.getFile(e,m,h(function(a){a.createWriter(h(function(b){b.onwriteend=function(b){p.location.href=a.toURL();d.readyState=d.DONE;t(d,"writeend",b);s(a)};b.onerror=function(){var a=b.error;a.code!==a.ABORT_ERR&&g()};["writestart","progress","write","abort"].forEach(function(a){b["on"+
        a]=d["on"+a]});b.write(c);d.abort=function(){b.abort();d.readyState=d.DONE};d.readyState=d.WRITING}),g)}),g)};a.getFile(e,{create:!1},h(function(a){a.remove();b()}),h(function(a){a.code===a.NOT_FOUND_ERR?b():g()}))}),g)}),g)):g()}},b=m.prototype;b.abort=function(){this.readyState=this.DONE;t(this,"abort")};b.readyState=b.INIT=0;b.WRITING=1;b.DONE=2;b.error=b.onwritestart=b.onprogress=b.onwrite=b.onabort=b.onerror=b.onwriteend=null;return function(a,b){return new m(a,b)}}}("undefined"!==typeof self&&
        self||"undefined"!==typeof window&&window||this.content);"undefined"!==typeof module&&null!==module?module.exports=saveAs:"undefined"!==typeof define&&null!==define&&null!=define.amd&&define([],function(){return saveAs});
    </script>
	<script>
    /*
    SecureExam v1.0.0
    code.google.com/p/secureexam
    (c) 2014 by ZHAW, Simon Lukes, Daniel Jampen. All rights reserved.
    lukessim@students.zhaw.ch, jampedan@students.zhaw.ch
    */
	var userName;
	var userSecret;
	var seInfos;
	var SHA256ITERATIONS = 100000;
        
	var EXAMSTARTTIME = new Date($EXAMSTARTTIME$);
	var EXAMENDTIME = new Date($EXAMENDTIME$);
	var EXAMDURATION = $EXAMDURATION$;
       
	var secureTime;
	var checkInternetConnection;
	var updateTimeInterval;
	var autoSaveInterval;

	/*
	 *	Class secureExamInfos()
	 *	Constructor-Arguments: none
	 *
	 *  description: class stored in localDB.
	 */
	function secureExamInfos() {
		var _this = this;
		_this.examStartTime = new Date();
		_this.examEndTime = null;
		_this.examExpireTime = new Date(_this.examStartTime);
		_this.examExpireTime.setMinutes( _this.examExpireTime.getMinutes() + EXAMDURATION );
		_this.examStartings = 1;
		_this.examFocusChanges = 0;
		_this.examValid = true;
        _this.invalidReason = "";
		_this.studentSecret = userSecret;
		_this.load = function ( oldSEInfo ) {
			try {
				var dec = CryptoJS.AES.decrypt(oldSEInfo, userSecret);
				var decString = dec.toString(CryptoJS.enc.Utf8);
				var oldData = decString.substring(16,decString.length-1).split(",");
				if( decString.substring(0, 15) === "secureExamInfos" && oldData[3] === userSecret) {
					_this.examStartTime = new Date(oldData[0]);
					_this.examEndTime = (oldData[1] !== "null")? new Date(oldData[1]): null;
					_this.examStartings += Number(oldData[2]);
					_this.studentSecret = oldData[3];
					_this.examFocusChanges = oldData[4];
					_this.examValid = (oldData[5] == "true")?true:false;
					_this.examExpireTime = new Date(oldData[6]);
                    _this.invalidReason = oldData[7];
				}
			}catch (err) {}
		}
		_this.export = function () {
			var exportString = 'secureExamInfos(' + _this.examStartTime + ',' + _this.examEndTime + ',' + _this.examStartings + ',' + _this.studentSecret + ',' + _this.examFocusChanges + ',' + _this.examValid + ',' + _this.examExpireTime + ',' + _this.invalidReason + ')';
			return CryptoJS.AES.encrypt( exportString, userSecret);
		}
	};

	/*
	 *	Class InternetAccessCheck()
	 *	Constructor-Arguments: none
	 *
	 *  description: class to check internet Access and if so, fire events to observers
	 */
	function InternetAccessCheck() {
		var _this = this;
		_this.state = false;
		_this.ms = 5000;
		_this.irregulationsObservers = new Array();

		_this.onLoad = function () {
			_this.state = true;
			_this.notifyObservers();
		}

		_this.onError = function (e) {
			state = false;
		}

		_this.inteval = window.setInterval(function () {
			var img = new Image();
			img.onload = _this.onLoad;
			img.onerror = _this.onError;
			img.src = 'http://waikiki.zhaw.ch/~rege/t-menu/header_left.jpg?t=' + new Date().getTime();
		}, _this.ms);

		_this.notifyObservers = function () {
			for (i = 0; i < _this.irregulationsObservers.length; i++) {
				_this.irregulationsObservers[i].notify("Internet Connection Detected @" + new Date().toUTCString());
			}
		}

		_this.addIrregulationsObserver = function (observer) {
			_this.irregulationsObservers.push(observer);
		}

		_this.removeIrregulationsObserver = function (observer) {
			for (i = 0; i < _this.irregulationsObservers.length; i++) {
				if (_this.irregulationsObservers[i] === observer) {
					_this.irregulationsObservers.splice(i, 1);
					return true;
				}
			}
			return false;
		}

		_this.stop = function () {
			clearInterval(_this.inteval);
		}
	}
        
    
    /*
     *  Date Prototypes
     */

	Date.prototype.toDebugOutputString = function() {
		return this.getHours()+ ":" + this.getMinutes() + ":" + this.getSeconds() + ":" + this.getMilliseconds();
	}
	Date.prototype.toHHMMSSString = function() {
		var h = this.getHours();
		if(h < 10) h = "0"+h;
		var m = this.getMinutes();
		if(m < 10) m = "0"+m;
		var s = this.getSeconds();
		if(s < 10) s = "0"+s;
		return h + ":" + m + ":" + s;
	}

	/*
	 *	Class secureDate()
	 *	Constructor-Arguments: - none
	 *
	 *
	 *  description: class to handle save, reliable and non-manipulatable Time.
	 */
	function secureDate(  ) {
		var _this = this;
		_this.DEBUG = false;
		_this.INTERNALUPDATEINTERVAL = 1000;
		_this.INTERNALCLOCKMAXVARIANCE = 50;
		_this.TIMEHISTORYMAXVARIANCE = 50;

		_this.timeHistory = new Array();
		_this.internalClockMilliseconds = 0;
		_this.irregulationsObservers = new Array();
		_this.internalClockStartTime = new Date();

		(_this.DEBUG) ? console.log("[secureDate] started...") : "";

		_this.interval = window.setInterval(function () {
			var systemTime = new Date();
			_this.internalClockMilliseconds += secureTime.INTERNALUPDATEINTERVAL;
			var internalTime = _this.getInternalTime();

			// verify InternalTime
			if (_this.dateCompare(internalTime, systemTime)) {
				// compensate cpu lag in internal Time (systemTime is more accurate)
				var diff = systemTime.getTime() - internalTime.getTime();
				if (diff > 0) {
					_this.internalClockStartTime.setTime(_this.internalClockStartTime.getTime() + diff);
					(_this.DEBUG) ? console.log("[secureDate] compensing cpu lag: " + diff + "ms") : "";
				}

				// check with History
				if (_this.timeHistory.length == 10) _this.timeHistory.shift();
				_this.timeHistory.push(new Date(systemTime));

				for (i = 0; i < _this.timeHistory.length; i++) {
					var historyOffset = i * _this.INTERNALUPDATEINTERVAL;
					var historyVariance = i * _this.TIMEHISTORYMAXVARIANCE;
					var recalculatedTime = new Date(_this.timeHistory[_this.timeHistory.length - 1 - i]);
					recalculatedTime.setTime(recalculatedTime.getTime() + historyOffset);
					if (!_this.dateCompare(systemTime, recalculatedTime, historyVariance)) {
						_this.notifyObservers("[secureDate] updateClock HistoryTime([" + i + "]," + recalculatedTime.toDebugOutputString() + ") and SystemTime(" + systemTime.toDebugOutputString() + ") not in sync!");
						_this.stop();
						return false;
					}
				}
				(_this.DEBUG) ? console.log("[secureDate] UPDATED: status OK | internalclock @ " + internalTime.toDebugOutputString() + " historynewest @ " + _this.timeHistory[_this.timeHistory.length - 1].toDebugOutputString()) : "";
				return true;
			} else {
				_this.notifyObservers("[secureDate] updateClock InternalTime(" + internalTime.toDebugOutputString() + ") and SystemTime(" + systemTime.toDebugOutputString() + ") not in sync!");
				return false;
			}
		}, 1000);

		_this.getInternalTime = function () {
			var date = new Date(_this.internalClockStartTime);
			date.setMilliseconds(date.getMilliseconds() + _this.internalClockMilliseconds);
			return date;
		}

		_this.dateCompare = function (actualTime, timeToVerify, maxVariance) {
			var maxVariance = (typeof maxVariance !== "undefined") ? maxVariance : _this.INTERNALCLOCKMAXVARIANCE;
			timeToVerify = new Date(timeToVerify);
			actualTime = new Date(actualTime);

			var variance = timeToVerify.getTime() - actualTime.getTime();
			if (variance <= maxVariance && variance >= -maxVariance) {
				return true;
			}
			return false;
		}

		_this.notifyObservers = function (msg) {
			for (i = 0; i < _this.irregulationsObservers.length; i++) {
				_this.irregulationsObservers[i].notify(msg);
			}
		}

		_this.stop = function(){
			clearInterval(_this.interval);
		}
		_this.addIrregulationsObserver = function (observer) {
			(_this.DEBUG) ? console.log("[secureDate] added observer " + observer) : "";
			_this.irregulationsObservers.push(observer);
		}
		_this.removeIrregulationsObserver = function (observer) {
			for (i = 0; i < _this.irregulationsObservers.length; i++) {
				if (_this.irregulationsObservers[i] === observer) {
					_this.irregulationsObservers.splice(i, 1);
					return true;
				}
			}
			return false;
		}
	}

	/*
	 *	Class IrregulationsObserver()
	 *	Constructor-Arguments: - action = function to call when observer gets notified
	 *
	 *
	 *  description: Observer Class for Observable Classes ;)
	 */
	function IrregulationsObserver( action ) {
		var _this = this;
		_this.action = action;

		_this.notify = function( msg ) {
			_this.action( msg );
		}
	}

	/*
	 *	FUNCTION decrypt()
	 *	arguments: - (string) divUserKeyDB = div ID where the UserKey Information is written
	 *			   - (string) divSecretStuff = div ID where the encrypted data is stored
	 *			   - (string) divQuestions = div ID where the decrypted data will be written into
	 *
	 *  description: decrypt the questions.
	 */
	function decrypt(divUserKeyDB, divSecretStuff, divQuestions) {
		// Get Secret
		userSecret = document.getElementById("userSecret").value;
		if( userSecret == "" ) {
			document.getElementById("userSecret").style.border = "1px solid red";
			return;
		}

		// extract Username for comparison with userKeyDB
		userName = userSecret.substring(0,userSecret.length - $RANDOMCHARSINUSERSECRET$);

		// local DB
		seInfos = new secureExamInfos();
		if( window.localStorage.getItem("secureExam") != null ) {
			seInfos.load(window.localStorage.getItem("secureExam"));
		} else {
			// we have a new run, check if we're allowed to start the exam..
			if( new Date() > EXAMENDTIME ) {
				document.getElementById("questions").innerHTML = '<p class="questionText center">Prüfungszeitraum abgelaufen!</p>';
				return;
			} else if( new Date() < EXAMSTARTTIME ) {
				document.getElementById("questions").innerHTML = '<p class="questionText center">Prüfung noch nicht freigegeben!</p>';
				return;
			}
		}

		// check if exam has been done before
		if(seInfos.examEndTime != null ) {
			document.getElementById("questions").innerHTML = '<p class="questionText center">Prüfung bereits abgelegt!</p>';
			return;
		}

		// update Timeleft
		updateTimeLeft(true);

		// check if we have a restore point
		var restored;
		if( window.localStorage.getItem("secureExamAutoSave") != null ) {
			try {
				var dec = CryptoJS.AES.decrypt(window.localStorage.getItem("secureExamAutoSave"), userSecret);
				document.getElementById(divQuestions).innerHTML = dec.toString(CryptoJS.enc.Utf8);
				document.getElementById("autoSaveInfo").innerHTML = '<p class="headerHighlight">letzte automatische Sicherung wiederhergestellt!</p>'
				restored = true;
			} catch(e) {
				restored = false;
			}
		}

		// new Exam? decrypt...
		if( !restored ) {
			try {
				// load userKeyDB & questionDiv
				var userKeyDB = document.getElementById(divUserKeyDB).innerHTML.split("<br>");
				var questionDiv = document.getElementById(divSecretStuff).innerHTML.split(",");

				// remove empty last entry from userKeyDB
				userKeyDB.pop();
				// split username from secret
				for (i = 0; i < userKeyDB.length; i++) {
					userKeyDB[i] = userKeyDB[i].split(",");
				}

				// get encryptedMasterkey cypher for this user
				var masterkeyCypher;
				var masterkeyIV;
				var saltB64;
				for (i = 0; i < userKeyDB.length; i++) {
					if (userName == userKeyDB[i][0]) {
						masterkeyCypher = CryptoJS.enc.Hex.parse(userKeyDB[i][1]);
						masterkeyIV = CryptoJS.enc.Hex.parse(userKeyDB[i][2]);
						saltB64 = userKeyDB[i][3];
						break;
					}

				}

				// generate key
				var userSecretSalted = userSecret + saltB64;
				var key = CryptoJS.SHA256(userSecretSalted);

				for (i = 0; i < SHA256ITERATIONS - 1; i++) {
					key = CryptoJS.SHA256(key);
				}

				// decrypt masterkey
				var masterKeyCipherParams = CryptoJS.lib.CipherParams.create({
					ciphertext: masterkeyCypher,
					key: key,
					iv: masterkeyIV,
					algorithm: CryptoJS.algo.AES,
					mode: CryptoJS.mode.CBC,
					padding: CryptoJS.pad.PKCS7,
					blockSize: 4,
					formatter: CryptoJS.format.OpenSSL
				});

				var decMasterKey = CryptoJS.AES.decrypt(masterKeyCipherParams, key, {iv: masterkeyIV});
				var masterKeyString = decMasterKey.toString(CryptoJS.enc.Utf8);
				var masterKey = CryptoJS.enc.Hex.parse(masterKeyString);

				// decrypt questions
				var questionsIV = CryptoJS.enc.Hex.parse(questionDiv[0]);
				var questionsCipher = CryptoJS.enc.Hex.parse(questionDiv[1]);

				var questionsCipherParams = CryptoJS.lib.CipherParams.create({
					ciphertext: questionsCipher,
					key: masterKey,
					iv: questionsIV,
					algorithm: CryptoJS.algo.AES,
					mode: CryptoJS.mode.CBC,
					padding: CryptoJS.pad.PKCS7,
					blockSize: 4,
					formatter: CryptoJS.format.OpenSSL
				});

				var decrypted = CryptoJS.AES.decrypt(questionsCipherParams, masterKey, { iv: questionsIV });
				var decryptedString = decrypted.toString(CryptoJS.enc.Utf8);

				// print questions
				document.getElementById(divQuestions).innerHTML = decryptedString;
			} catch (e) {
				document.getElementById("userSecret").style.border = "1px solid red";
				return;
			}
		}
		// show finish button
		document.getElementById("finishButton").innerHTML = '<button onclick="confirmFinishExam()">Prüfung einreichen</button>';

		// save secureExam object
		window.localStorage.setItem("secureExam", seInfos.export());

		// print examDetails
		var examDetails = document.getElementById("studentDetails");
		var name = userName.substring(0,userName.length - 9);
		for( i = 1; i < name.length; i++ ) {
			if( name[i] == name[i].toUpperCase() ) {
				name = name.replace(name[i], " " + name[i]);
				break;
			}
		}
		var immnumber = userName.substring(userName.length -9, userName.length);

		// student
		if( name != "") {
			examDetails.innerHTML = examDetails.innerHTML.replace("$NAME$", name);
			examDetails.innerHTML = examDetails.innerHTML.replace("$IMMNUMBER$", immnumber);
		} else {	// professor
			examDetails.innerHTML = "Name: " + immnumber;
			document.getElementById("finishButton").innerHTML += ' <button onclick="resetLocalUserDB()">Reset LocalUserDB</button>';
		}
		document.getElementById("studentDetails").classList.remove("hidden");

		// start SecureDate
		secureTime = new secureDate();
		var secureTimeObserver = new IrregulationsObserver( timeErrorEvent );
		secureTime.addIrregulationsObserver( secureTimeObserver );

		// start checkInternetConnection
		checkInternetConnection = new InternetAccessCheck();
		var internetAccessObserver = new IrregulationsObserver( internetAccessErrorEvent );
		//checkInternetConnection.addIrregulationsObserver( internetAccessObserver );

		// start Timers
		autoSaveInterval = window.setInterval(autoSave,15000);
		updateTimeInterval = window.setInterval(updateTimeLeft,1000);

		// show timeleftTitle
		document.getElementById("timeLeftTitle").classList.remove("hidden");
	}

	function resetLocalUserDB() {
		window.localStorage.removeItem("secureExam");
		window.localStorage.removeItem("secureExamAutoSave");
		location.reload();
	}

	function confirmFinishExam() {
		if( confirm("Wollen Sie wirklich die Prüfung einreichen? Dies kann nicht rückgängig gemacht werden!")) {
			finishExam();
		}
	}
	/*
	 *	FUNCTION finishExam()
	 *	arguments: none
	 *
	 *  description: finish the Exam, set and store examEndTime, export questions to encrypted xml download.
	 */
	function finishExam() {
		// stop timer
		secureTime.stop();
		checkInternetConnection.stop();
		clearInterval(updateTimeInterval);
		clearInterval(autoSaveInterval);

		// set SEINFOS
		seInfos.examEndTime = new Date();
		window.localStorage.setItem("secureExam", seInfos.export());

		// export
		exportExam();

		// set views
		document.getElementById("questions").innerHTML = '<p class="questionText center">Prüfung abgeschlossen!</p>';
		document.getElementById("finishButton").innerHTML = '';
	}

	function exportExam() {
		var xml = '<?xml version="1.0" encoding="iso-8859-1"?>';
		xml += '<exam>';
		xml += '<student>';
		xml += '<name>' + userName.substring(0,userName.length -9) + '</name>';
		xml += '<nr>' + userName.substring(userName.length -9, userName.length) + '</nr>';
		xml += '</student>';
		xml += '<examInfos>';
		xml += '<startTime>' + seInfos.examStartTime.toUTCString() + '</startTime>';
		xml += '<endTime>' + seInfos.examEndTime.toUTCString() + '</endTime>';
		xml += '<focusChanges>' + seInfos.examFocusChanges + '</focusChanges>';
		xml += '<examStartings>' + seInfos.examStartings + '</examStartings>';
		xml += '</examInfos>';
		if( seInfos.examValid ) {
			xml += '<questions>';
			var questions = document.getElementById("exam");
			for( i = 0; i < questions.children.length; i++) {
				var question = questions.children[i];
				xml += '<question>';
				for( var j = 0; j < question.children.length; j++ )
				{
					var pTag = question.children[j];
					switch( pTag.className)
					{
						case "questionText":
							xml += '<legend>' + pTag.innerHTML + '</legend>';
							break;
						case "answer":
							for( var k = 0; k < pTag.children.length; k++) {
								var inputTag = pTag.children[k];
								switch( inputTag.tagName ) {
									case "INPUT":
										switch (inputTag.type) {
											case "checkbox":
												xml += '<input type="checkbox" ' + (inputTag.checked == true ? "checked=\"true\" " : "") + '/>';
												break;
										}
										break;
									case "TEXTAREA":
										xml += '<input type="text">' + inputTag.value + '</input>';
										break;
								}
							}
							break;
					}
				}
				xml += '</question>';
			}
			xml += '</questions>';
		}
		else {
			xml += '<examInvalid>' + seInfos.invalidReason + '</examInvalid>';
		}
		xml += '</exam>';

		// encrypt output
		//var encXml =  CryptoJS.AES.encrypt( xml, userSecret);
		//xml = encXml.iv.toString() + "," + encXml.ciphertext.toString();

		// generate download
		var blob = new Blob([xml], {type: "text/plain;charset=utf-8"});
		var ret = saveAs(blob, "exam_" + userName + ".xml.enc");
	}

	function keyUpUserSecret(e) {
		if(e.keyCode == 13) {
			decrypt('userKeyDB','secretStuff','questions');
		}
	}

	var timeErrorEvent = function( msg ) {
		secureTime.stop();
		console.log(msg);
		seInfos.examValid = 0;
		seInfos.invalidReason = msg;
		finishExam();
		document.getElementById("questions").innerHTML = '<p class="questionText center">Prüfungsabbruch, Zeitmanipulation entdeckt!</p>';
	}

	var internetAccessErrorEvent = function(msg) {
		checkInternetConnection.stop();
		console.log(msg);
		seInfos.examValid = 0;
		seInfos.invalidReason = msg;
		finishExam();
		document.getElementById("questions").innerHTML = '<p class="questionText center">Prüfungsabbruch, Internetzugriff aktiviert!</p>';
	}

	function autoSave() {
		var questions = document.getElementById("exam").children;
		for( i = 0; i < questions.length; i++) {
			var answerForms = questions[i].children[1].children;
			for( j = 0; j < answerForms.length; j++) {
				switch( answerForms[j].tagName ) {
					case "INPUT":
							switch (answerForms[j].type) {
								case "checkbox":
									if(answerForms[j].checked)answerForms[j].setAttribute("checked",true);
									break;
							}
							break;
					case "TEXTAREA":
							answerForms[j].innerText = answerForms[j].value;
							break;
				}
			}
		}
		window.localStorage.setItem("secureExamAutoSave",CryptoJS.AES.encrypt(document.getElementById("questions").innerHTML,userSecret));
		document.getElementById("autoSaveInfo").innerHTML = "AutoSave: " + new Date().toHHMMSSString();
	}

	function visibilityChanged() {
		if( document.hidden ) {
			secureTime.stop();
			autoSave();
			console.log(seInfos);
			seInfos.examFocusChanges++;
			window.localStorage.setItem("secureExam", seInfos.export());
			location.reload();
		}
	}

	function updateTimeLeft(forcePrint) {
		var now = new Date();
		if( now <= seInfos.examExpireTime && now >= EXAMSTARTTIME && now <= EXAMENDTIME ) {
			var diff = seInfos.examExpireTime - now;
			diff = diff / 1000;
			var s = Math.floor(diff % 60);
			if( s < 10 ) s = "0"+s;
			var m = Math.floor(diff/60);
			if( m < 10 ) m = "0"+m;

			if( (m >= 10 && s == "00") || ( m < 10)) {
				document.getElementById("timeLeft").innerHTML = m + ":" + s;
				if( m < 10 ) {
					document.getElementById("timeLeft").classList.add("headerHighlight");
					document.getElementById("timeLeftTitle").classList.add("headerHighlight");
				}
			}
			else if(forcePrint ) {
				if( EXAMDURATION == (m + 1)) {
					document.getElementById("timeLeft").innerHTML = EXAMDURATION + ":00";
				} else {
					document.getElementById("timeLeft").innerHTML = (m + 1) + ":00";
				}
			}
		}
		else {
			if( document.getElementById("exam") == null) { // handle exam Expire when tab hidden
				seInfos.examExpireTime.setSeconds(now.getSeconds() + 5);
				EXAMENDTIME = seInfos.examExpireTime;
			} else {
				finishExam();
				if( now >= EXAMENDTIME ) {
					document.getElementById("questions").innerHTML += '<p class="questionText center">Prüfungszeitraum abgelaufen</p>';
				}
			}
		}
	}

	document.addEventListener("visibilitychange",visibilityChanged);
	</script>
</head>
<body>
	<div class="header paper" id="header">
		<div class="headerNotes">
			<span class="zhaw">ZHAW School of Engineering</span>
			<span id="timeLeftTitle" class="hidden">Verbleibende Zeit:</span>
			<span id="timeLeft"></span>
		</div>
		<div id="autoSaveInfo"></div>
		<div class="headerTitle">
			ADS: Algorithmen und Datenstrukturen
			<p id="studentDetails" class="headerStudentInfo hidden">Name: $NAME$ Immatrikulationsnummer: $IMMNUMBER$</p>
		</div>
		<div id="finishButton"></div>
	</div>
	<div class="examNotes paper" id="examNotes">
		<p class="notes">Prüfungshinweise:kein Rechner!ein A4 Blatt Handgeschrieben!</div>
	<div class="examContainer paper">
		<div id="questions">
				<p class="questionText center">Bitte geben Sie ihr Identifikationspasswort ein!</p>
				<p class="questionText center">
					<input type="text" id="userSecret" size="35" onkeyup="return keyUpUserSecret(event)"/>
					<button onclick="decrypt('userKeyDB','secretStuff','questions')">Prüfung starten!</button>
				</p>
		</div>
	</div>
	<div class="hidden">
		<div id="secretStuff" class="longShizzle">40D4B4BA30FA7EA366E5A4D264560CE1,1CBC814A08026BA83D9D025F5B7E09EE7BA79554314C0F97C844DBD229C49E35052F3A384D620BB80CF473A1F9C512DC1CA2D3D23027CCF5B483CF7C57467492CAAF02017B05A5FE87F8913A42D823216D63D04C9E9CDF7405B78E27623C5B1D0A0AE8D8F8D72B65572830522DCF578CCAE2D72C7E2D8E65C88D6111EA1DDE36F698158BFC9BF80C42753382B16EAB94590D91A85A9B627B6046D356EDAE066AAABC6E8413CBD21152845DF44D0C41FE1608A82EA66F4547392402490F7F9B0F53421BB7FF41E54D19F51A9DC265FAF3AF7ECF7FC6774A6BBCF199357E387A51FE02C1814478B66B7118DE0A139978484515E9529D39F535AD550ACCA87534A7F769F23E86990DE636A59F1537CDC692AE419C2AF37832BEA9A81719EF479A3ECAA2F986634B1954C505315660B6B3DCD43E2A8B290F37BFF22E78032661F4C41931F4931AB69DE2BD5825F944454AA70C60DEFE508322334BBB5F41AE418AB91ECCD8E8812B26BC3184E7ECE094B4E576E951C8842E89F85DFA9509B7E6DE72D12EF90041DC265456DE9999BB6A4ACDEE4DB9522DEC80FD6D20B8AD5B4E9F8D07C7B09EB00650ADA746E2DA98E89DE0122D05BCB30D1DF84A101B2489C87F2757900C0719158A551637D885321030EA3C9C0B417B34279216429F21C898F48E949A1F4C618DF3A285C315E4E3CB49B98F4E9AEEA0CAC28A10A3EB45F8287D993EDC70C9CB2500E401F6EB48750FB1BAFABD9706B7E9B73C8B0E3AC75931FC507BBC7E814860B397898140CB5CDB9AF46ECB80569F5DAD02A6830E4A6128FE07BFA4B2564CF4B11E70C1EB66D759F6AE3B4A36227BAEA352B1265F92D5B63DFAF006BCBC0C5650A4B26AB027B626CBB9D593A49EB8E0B9AA819F875D5C0F584C81260BEA76C2FA79896A614F3C7C97C99D03E9945C3C9861FA1F6B5CB04C1A70917C738EADAA76947EBC71BD4B6DB8902C397EAA36265FD27AC90034F0F16524276CF3A3E2001F563A4C33C8D607250CEE8A39B88576E967435995D77A0997A105721E259CF1F07D8695EF1084AA9F6DF247001F96080AF900A10FD074BF9EB6953344A55C49F22B2C7DC4928560FB6C8287DB58D7366CBDC9F025244E5FB79B2B1CEBB76C6CB76C259C40E7AFB5D39A22CF54AEEBB288ED2CDD489BBAECDEFB0C19DBCDC925DC133C95ECEE86F6EFB9EE5CA9B75EC2694B5337E5828D58E010550ABB14A69A52460FE74942E41DE663AC29D7CEDD71102BE9DE324147CCD71A758FD4FA78348155FAD14854AF3348E0DBB4128FF19670A509700A31DE1702053BFF1FEA271660A547C7F42B2CB477216306E987E2ADC2C684A52F162E722030977990D66B52EFC3465D090D11C26B228CE990E19FFEB0B46FFF5F6EEB17ABB2A0BE2E27C00A149779C559EA2E21BDE9ED9E2AEE03A36E53739494C34EB38FF37BBD6FDF003DD4FA649BC2BD4AD7FE13D42022F995862A8C023C69638ED3D4B69C356B0957F6B8B8DBFFB45CC66B455E6B7E46AE916C7B696B3B7EBF3D141577AAA7C74A9DC7A83B16260851B81C3616F7F55EB0A112F48C793AB576874CBF5DFD53D83C260C9A702EB160C9FA7FF0E2D46544C6AE5A2B9DD4FC2E513C8F0E660D36DB0A7DC8EA49E3288C68824C8D424781DD1535C782000F246004E80597AD302D6BA9A39641F07E8E9C8ADD79AFE967EEDA98D0C528209B838C4CD5F5002F3E9051E80A39A4ED6150C21D60A76DFB2D43914D3ADF34747C9805E4AD8189B6F2546486C7AF625A2E72748F3332B45F7B27CED83916BCE7283277477C6C9CDAD9074CE1A3DBA5D18945A314731597BA80068C17F066B2074ADE4DAA49C44C72CCC8BB7CD1CEEFD8FFD41A4AA35DAACC0CDBCBFEB14E5AD8E60548D3FBD362DCCB81A5BD3A4C253DED199D6A020B7E7D5CD3D20330E973E78AB218903C62CF2467EAB4DF2212FE2CCAE42A6BFB368A599825EBB0F908CAF906E94A8EC0F4B5E1035F3AC6A0DCFF025CDBD47DBB3E9D428BDA04719E1384AE5910065737E5FA02D947EA0E5EA3129D04B8183B2A7F086E2C34884E4625CEA191B9D89C0A1909A909437C0511628AA1AE1C1936BB45BE89718E490A5178B21EC41C543BF89B409C9DB8DCEB2C5E58443036E5E3A74CBCF8AC37BA52808D7CF1FED72E2D3070B40E68943A716E9CF2FA6D8B472E6CB79407B911D0C1F16F558373DC66BBC506854DDDC899CC091DD939974624A10FE05A6D831BB41BCB22A79A20DB99D43CD132125F09F9CF52600F057FD00B4A7C144CE6D9F64876AC288C06F3F6423937524DA831AB5830051B8DE51E188DB4FE52566B5123D43351A98491185F388B85998D3CE3DBC778F6E77976464AA68A1D860702E99FB5338D2839DFC912D8681E2F6CED18067F3E75FF6EC5E016384F5DB59D150680CE8904457FAB338AA77F16D6B67C18E18ACDA98E59F81BA736A1061D2F1CDC31BC30F82F02465AADFAB9677061A4A2B1373E10D67011D29800A9D0EFA3CE8D260A6ED4E0A6E7F42406347AB62D02736C4AFAD09E035763B19B5D59C92E568BEFC4541CBC31AC4F238E2E293899AC88B68DE7564AA0D20334DEFB2E711F5D1334BD66ED286E772B9941DDF07D4EBE3E10565237882F5C722A78E809D1F2E5FE682694F896FA17A9C78FE28C701DBEA33CFADC529EC15FF127AA4E555B53ACF29F7389D002BEF047044B7E712DA431EE789C72F02718BEEFBC71155E4FF73030FEC3A58ABE9B1A0B076A81F0C982ED640D129B5697F7F3C2218D6D9CA5D354081721369CB9C38B03A9A445E213945D9AA690B930633CA7632CBDACD7F6558F92F3666C5C7F0139AEB39FDF76D6A53F15CE5F3A9A36D1154C2E027546B6ED801AB2AF7C73EE3680FE1CE2ED73E8EF171DB060F39315C6C4A8A8FC05333F1CB63F5AFC8E3E975C1F5E752C3087927C4CDF56763B532A286F11450E8F8BC61768A494F6F296E1495D64008215A32A2D4B5A80CDA78898D81FACDF0EB0D89CA2CF07FB64990374BB19B5974F1769C3C2CF3B3A691AFCD7CF84AB6411CB00B98C64788F1A636C4A2C6D21F54467365F599327C3961BD25489098C1FD3C0B45A2A06DB984DADF9050396B47EBD64E9150C60A0454DA333C6B2A48F21FC749AFB392D92A45397AEA7FB045DFA30C733E50295934E2FC14EA92713DD0A4556C0100D1C4CEE02A01BDEA38EC49B9512E248962AAC5110E25E5C60451B16FE6326F485156C4C555689ACBDF29DA491B3771CBEC4808D8F03A630FE6C91C309BA974F3AFD6CC86F3825BE3F598B1788ECF7F395EAF97AB531B892CF5697BA9EC3E50B58B655D59B96A560995231052DA51CAA56BE0822165599E6B28BB10B33E188C66C4D9BD255A36CE01F7F68786790B888E3E3</div>
		<div id="userKeyDB">rege,4A636EA647B1036B68F02DE730BD8B70A3C3B0B8CC0FDF04AA1E23AAA418ECE63F1659D6FFBD3E1392A0DF4F7B3B656B9F3E090D6B95F3170DA8F48511EFF09696A7D7C28966DD75942E3A0428998678,707631315671939AB77CC05F9BEF657A,j7rqSSCuRLJuWutdV/JwM6DhsbbNU3PIb8mXoKQVhkk=;DanielJampenS12198320,5CFCD6F6C3DC21FED521AF970CDFD6715EAF582D5487ADA3044275E5E89345353A528409316FC349AC482E236E171A1CC162587DB64ACCE7301E4B5E71140B60913A50B1BD838A3C67FCCE3DC69B6839,75B79C4C0CCD82887D5C6F15F1AF7601,1gTPaa6Kkz0tj1aCRFKjRPp4gMOPM+B0tPFF4XEvNBw=;SimonLukesS12198347,D3DCC826F88955339DBF0E5A26DB0DCEBA79D8FC55D3E8589AFF53FC1C9A4294A2CB4EA05FB23280AF0543350F4A7D7F28505A3D5BABA8CB946739C95B3D78A316FA905B6367EAB9116FB9A1755E828A,436F35240E466BBE7E6D37FB43D965DD,fj5CBb+gd8NDIrhVZChq2kTE2grTiDKzi2E/4mzbmI4=;</div>
	</div>
</body>
</html>